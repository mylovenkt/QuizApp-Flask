{% extends 'layout.html' %}

{% block title %}Add Questions{% endblock %}

{% block body %}
<form method="post" action="{{ url_for('main.add_questions') }}" enctype="multipart/form-data">
  <h1 class="text-center">Add Questions</h1>
  <br><br>
  {% for i in range(1, questions+1) %}
  <div class="mb-3">
    <label for="questionType{{ i }}" class="form-label">Question Type {{ i }}*</label>
    <select class="form-select" id="questionType{{ i }}" name="qt{{ i }}" onchange="toggleQuestionOptions({{ i }})" required>
      <option value="multiple_choice">Multiple Choice</option>
      <option value="true_false">True/False</option>
      <option value="image">Image Based</option>
    </select>
  </div>

  <div class="mb-3">
    <label for="InputQuestion{{ i }}" class="form-label">Question {{ i }}*</label>
    <input type="text" class="form-control" id="InputQuestion{{ i }}" name="q{{ i }}" required>
  </div>

  <!-- Image upload for image-based questions -->
  <div class="mb-3 image-upload{{ i }}" style="display: none;">
    <label for="questionImage{{ i }}" class="form-label">Question Image</label>
    <input type="file" class="form-control" id="questionImage{{ i }}" name="qi{{ i }}" accept="image/*">
  </div>

  <!-- Options section -->
  <div class="options-section{{ i }}">
    <div class="row multiple-choice{{ i }}">
      <div class="col">
        <input type="text" class="form-control" placeholder="Option 1" name="q{{ i }}o1">
      </div>
      <div class="col">
        <input type="text" class="form-control" placeholder="Option 2" name="q{{ i }}o2">
      </div>
      <div class="col">
        <input type="text" class="form-control" placeholder="Option 3" name="q{{ i }}o3">
      </div>
      <div class="col">
        <input type="text" class="form-control" placeholder="Option 4" name="q{{ i }}o4">
      </div>
    </div>

    <div class="true-false{{ i }}" style="display: none;">
      <select class="form-select" name="q{{ i }}tf">
        <option value="T">True</option>
        <option value="F">False</option>
      </select>
    </div>
  </div>

  <br>
  <select class="form-select answer-select{{ i }}" name="q{{ i }}c" required>
    <option selected disabled value=''>Choose Correct Option</option>
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="C">C</option>
    <option value="D">D</option>
  </select>
  <br>
  {% endfor %}

  <!-- Category and Difficulty selections -->
  <div class="mb-3">
    <label for="category" class="form-label">Category</label>
    <select class="form-select" name="category" required>
      <option selected disabled value="">Choose Category</option>
      {% for category in categories %}
      <option value="{{ category.id }}">{{ category.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label for="difficulty" class="form-label">Difficulty</label>
    <select class="form-select" name="difficulty" required>
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
    </select>
  </div>

  <div class="mb-3 form-check">
    <input type="checkbox" class="form-check-input" id="exampleCheck1" required>
    <label class="form-check-label" for="exampleCheck1">I confirmed.</label>
  </div>
  <br>
  <button type="submit" class="btn btn-primary w-100" {% if not show %}onclick="question_already_added(); return false"{% endif %}>Submit</button>
</form>

<script>
function toggleQuestionOptions(questionNum) {
    const questionType = document.getElementById(`questionType${questionNum}`).value;
    const multipleChoice = document.querySelector(`.multiple-choice${questionNum}`);
    const trueFalse = document.querySelector(`.true-false${questionNum}`);
    const imageUpload = document.querySelector(`.image-upload${questionNum}`);
    const answerSelect = document.querySelector(`.answer-select${questionNum}`);

    // Hide all first
    multipleChoice.style.display = 'none';
    trueFalse.style.display = 'none';
    imageUpload.style.display = 'none';

    // Show relevant sections based on question type
    switch(questionType) {
        case 'multiple_choice':
            multipleChoice.style.display = 'flex';
            answerSelect.innerHTML = `
                <option selected disabled value=''>Choose Correct Option</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
            `;
            break;
        case 'true_false':
            trueFalse.style.display = 'block';
            answerSelect.innerHTML = `
                <option selected disabled value=''>Choose Correct Option</option>
                <option value="T">True</option>
                <option value="F">False</option>
            `;
            break;
        case 'image':
            multipleChoice.style.display = 'flex';
            imageUpload.style.display = 'block';
            answerSelect.innerHTML = `
                <option selected disabled value=''>Choose Correct Option</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
            `;
            break;
    }
}

const question_already_added = () => {
    alert("You already added questions, wait until administrator not allow you to further add questions");
}
</script>
{% endblock %}
